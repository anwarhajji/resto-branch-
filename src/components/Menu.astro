---
import { getCollection } from "astro:content";
import { siteLang, siteCurrency } from "~/data/config";

// Fetch the collection of plates
const plates = await getCollection("plates");
const siteLangFormat = siteLang.replace("_", "-");
---

<!-- Quick Nav --><!-- Quick Nav -->
<div class="mb-20 sticky top-8 z-10">
  <nav
    class="custom-bg-light-brown text-brown rounded-full max-w-5xl mx-auto swiper-plates w-full flex items-center gap-4 justify-center overflow-hidden"
  >
    <ul
      id="plate-nav"
      class="px-6 py-3 swiper-wrapper h-auto w-auto flex gap-4 sm:justify-center overflow-x-auto"
    >
      {
        plates.map((plate) => (
          <li class="swiper-slide !w-max min-w-fit flex-shrink-0">
            <a
              href={`#${plate.data.slug}`}
              class="font-medium select-none whitespace-nowrap overflow-visible text-sm md:text-base"
            >
              {plate.data.prettyName}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</div>

<div class="grid grid-cols-1 gap-y-32">
  {
    plates.map((plate) => (
      <div id={plate.data.slug} class="space-y-16 scroll-mt-20">
        <div class="flex flex-col items-center gap-2 max-w-lg mx-auto text-balance text-center">
          <h3 class="h3 text-brown font-bold custom-bg-light-brown px-4 py-2 rounded-md">
            {plate.data.prettyName}
          </h3>
          <p>{plate.data.description}</p>
        </div>
        <dl class="max-w-5xl mx-auto">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-x-16 xl:gap-x-32">
            {plate.data.plates.map((item) => (
              <div>
                <dt>
                  <div class="flex justify-between items-center">
                    <span class="font-bold text-2xl tracking-wide">
                      {item.name}
                    </span>
                    <span class="font-medium text-lg">
                      {new Intl.NumberFormat(siteLangFormat, {
                        style: "currency",
                        currency: siteCurrency,
                      }).format(item.price)}
                    </span>
                  </div>
                </dt>
                <dd>
                  <p class="mt-2 text-gray-500 tracking-wide leading-normal text-balance">
                    {item.description}
                  </p>
                </dd>
              </div>
            ))}
          </div>
        </dl>
      </div>
    ))
  }
</div>

<script>
  import Swiper from "swiper";
  import "swiper/css";

  document.addEventListener("astro:page-load", () => {
    const swiperPlates = document.querySelector(".swiper-plates");
    if (swiperPlates) {
      new Swiper(swiperPlates, {
        loop: false,
        spaceBetween: 8, // Reduced spacing for smaller screens
        slidesPerView: "auto",
        freeMode: true, // Allow smooth scrolling without strict snapping
        watchSlidesProgress: true, // Enable dynamic slide updates
      });
    }
  });
</script>

<style>
  /* Remove max-width constraints and ensure single-line text */
  #plate-nav a {
    white-space: nowrap !important;
    max-width: none !important;
  }

  /* Optional: Add horizontal scroll padding */
  #plate-nav {
    scroll-padding-inline: 1rem;
  }

  @media (max-width: 768px) {
    /* Maintain text size and spacing for mobile */
    #plate-nav a {
      font-size: 0.875rem;
      padding: 0 0.5rem;
    }
    #plate-nav ul {
      gap: 12px;
    }
  }
</style>
